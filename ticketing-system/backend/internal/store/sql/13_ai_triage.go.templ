{{define "ai_triage_settings_get.sql"}}
SELECT enabled
FROM ai_triage_settings
WHERE project_id = $1
{{end}}

{{define "ai_triage_settings_upsert.sql"}}
INSERT INTO ai_triage_settings (project_id, enabled, updated_at)
VALUES ($1, $2, now())
ON CONFLICT (project_id) DO UPDATE
SET enabled = EXCLUDED.enabled,
    updated_at = now()
RETURNING enabled
{{end}}

{{define "ai_triage_suggestion_insert.sql"}}
INSERT INTO ai_triage_suggestions (
  project_id,
  actor_id,
  input_title,
  input_description,
  input_type,
  suggested_summary,
  suggested_priority,
  suggested_state_id,
  suggested_assignee_id,
  confidence_summary,
  confidence_priority,
  confidence_state,
  confidence_assignee,
  prompt_version,
  model
)
VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15)
RETURNING id, created_at
{{end}}

{{define "ai_triage_suggestion_get.sql"}}
SELECT
  id,
  project_id,
  suggested_summary,
  suggested_priority,
  suggested_state_id,
  suggested_assignee_id,
  confidence_summary,
  confidence_priority,
  confidence_state,
  confidence_assignee,
  prompt_version,
  model,
  created_at
FROM ai_triage_suggestions
WHERE id = $1 AND project_id = $2
{{end}}

{{define "ai_triage_decision_insert.sql"}}
INSERT INTO ai_triage_suggestion_decisions (
  suggestion_id,
  project_id,
  actor_id,
  accepted_fields,
  rejected_fields
)
VALUES ($1, $2, $3, $4, $5)
RETURNING id, created_at
{{end}}
