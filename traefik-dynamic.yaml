http:
  routers:
    # n8n - /n8n/* (highest priority after keycloak)
    n8n:
      rule: "PathPrefix(`/n8n`)"
      service: n8n
      priority: 200

    # Keycloak - /realms and /resources
    keycloak:
      rule: "PathPrefix(`/realms`) || PathPrefix(`/resources`)"
      service: keycloak
      priority: 100

    # Ticketing - everything else (including /auth/login, /auth/logout, /auth/me)
    # This catches all other paths including root /
    ticketing:
      rule: "PathPrefix(`/`)"
      service: ticketing
      priority: 1

  services:
    n8n:
      loadBalancer:
        servers:
          - url: "http://n8n:5678"

    keycloak:
      loadBalancer:
        servers:
          - url: "http://keycloak:8080"

    ticketing:
      loadBalancer:
        servers:
          - url: "http://ticketing-api-prod:8080"
